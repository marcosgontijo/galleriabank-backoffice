<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:shiro="http://shiro.apache.org/tags"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<title>Galleria Finanças</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="shortcut icon" type="image/x-icon"
		href="#{resource['image/Commons/icon.ico']}"></link>
	<link rel="stylesheet" type="text/css"
		href="#{resource['css/Style.css']}" title="" media="all" />
	<link rel="stylesheet" type="text/css"
		href="#{resource['css/InvestidorPageBootstrap.min.css']}" title=""
		media="all" />
	<link rel="stylesheet" type="text/css"
		href="#{resource['css/InvestidorPageStyle.css']}" title="" media="all" />
	<h:outputScript name="#{resource['js/functions.js']}"
		library="javascript" />
	<h:outputScript name="#{resource['js/locale-primefaces.js']}"
		library="javascript" />
</h:head>
<h:body onload="#{investidorMB.getContratosInvestidor()}">
	<p:messages id="mensagens" showDetail="true" />
	<div class="navbar-area">
		<div class="ui-g">
			<div class="ui-g-12 ui-md-4 ui-lg-4 responsiveIcons">
				<a class="navbar-brand" href="#"><img
					src="#{resource['image/LogoSiscoat.png']}" alt="" /></a>
			</div>
			<div class="ui-g-12 ui-md-6 ui-lg-6">
				<h:outputText value="OLÁ " styleClass="investidorLogin"
					style="color: #fff !important;padding-right: 7px;" />
				<h:outputText value="#{investidorMB.usuarioLogado.name}"
					styleClass="investidorLogin" style="color: #dfdfdf !important;" />
			</div>
			
			<div class="ui-g-12 ui-md-1 ui-lg-1 responsiveIcons">
				<h:form id="formRefresh">
					<p:commandLink title="Atualizar Portal" actionListener="#{investidorMB.getContratosInvestidor()}"
						style="padding-top: 7%;" update="@all">
						<img src="#{resource['image/AtualizacaoPortalInvestidor.png']}" alt="" />
					</p:commandLink>
				</h:form>
			</div>

			<div class="ui-g-12 ui-md-1 ui-lg-1 responsiveIcons">
				<h:form id="formLogout">
					<p:commandLink title="Sair" actionListener="#{logoutBean.logout}"
						style="padding-top: 7%;">
						<img src="#{resource['image/InvestidorPageExit.png']}" alt="" />
					</p:commandLink>
				</h:form>
			</div>
		</div>
	</div>
	<div class="slider-area">
		<h:form id="formDashboard">			
			<p:panel id="saldoSubConta" header="Consulta de Contratos"
				style="margin-bottom:10px;height: 500px;margin-top: 25px; ">
				<div class="ui-g">
					<div class="ui-g-12 ui-md-4 ui-lg-4">
						<div class="bgCardConciliacao">
							<div class="titulo">Contratos</div>
							<div class="texto">
								<h:outputText value="#{investidorMB.qtdeContratos}" />
							</div>
						</div>
					</div>
					<div class="ui-g-12 ui-md-4 ui-lg-4">
						<div class="bgCardConciliacao">
							<div class="titulo">Valor Investido</div>
							<div class="texto">
								R$
								<h:outputText value="#{investidorMB.valorInvestido}"
									converter="bigDecimalConverter" />
							</div>
						</div>
					</div>
					<div class="ui-g-12 ui-md-4 ui-lg-4">
						<div class="bgCardConciliacao">
							<div class="titulo">Valor Recebido</div>
							<div class="texto">
								R$
								<h:outputText value="#{investidorMB.valorRecebido}"
									converter="bigDecimalConverter" />
							</div>
						</div>
					</div>
				</div>
				<br />
				<br />
				<p:dataView var="contratos" value="#{investidorMB.contratos}"
					rows="12" paginator="false" rowsPerPageTemplate="6,12,16"
					paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					gridIcon="fa fa-fw fa-th-large" listIcon="fa fa-fw fa-bars"
					layout="grid" style="height:900px !important;">

					<p:dataViewGridItem>
						<p:panel header="Contrato - #{contratos.numeroContrato}"
							style="text-align:center">
							<h:panelGrid columns="1" style="width:100%">
								<br />
								<h:outputText value="Data do Contrato"
									style="color: #b87b2a; font-size: 18px; font-weight: bold;" />
								<h:outputText value="#{contratos.dataContrato}"
									style="color: #b87b2a; font-size: 18px;">
									<f:convertDateTime locale="pt_BR" />
									<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
								</h:outputText>
								<h:outputText value="Devedor"
									style="color: #b87b2a; font-size: 18px; font-weight: bold;" />
								<h:outputText value="#{contratos.pagador.nome}"
									style="color: #b87b2a; font-size: 18px;" />
								<br />
								<p:commandButton value="Financeiro" update=":formDetalhes:dtParcelas"
										oncomplete="PF('detalheContrato').show()"
										icon="fa fa-fw fa-search"
										action="#{investidorMB.getInformacoesDoInvestidorNoContrato(contratos)}" style="padding-left: 10px;">
										<f:setPropertyActionListener
														target="#{investidorMB.selectedContrato.numeroContrato}"
														value="#{contratos.numeroContrato}" />
								</p:commandButton>
								<p:spacer width="10" />
								<p:commandButton value="Envelope" update=":formDetalhesEnvelope:dtParcelasEnvelope"
										oncomplete="PF('detalheContratoEnvelope').show()"
										icon="fa fa-fw fa-search"
										action="#{investidorMB.getInformacoesDoInvestidorNoContrato(contratos)}" style="padding-left: 10px;"
										rendered="#{investidorMB.selectedContrato.listContratoCobrancaParcelasInvestidorSelecionadoEnvelope.size() gt 0}">
										<f:setPropertyActionListener
														target="#{investidorMB.selectedContrato.numeroContrato}"
														value="#{contratos.numeroContrato}" />
								</p:commandButton>
							</h:panelGrid>
						</p:panel>
					</p:dataViewGridItem>

					<p:dataViewListItem>
						<h:panelGrid columns="3" style="width:100%"
							columnClasses="logo,detail">
							<p:outputPanel>
								<h:panelGrid columns="4" cellpadding="5">
									<h:outputText value="Número Contrato " />
									<h:outputText value="Data Contrato "
										style="padding-left: 50px; color: #000 !important" />
									<h:outputText value="Devedor "
										style="padding-left: 50px; color: #000 !important" />
									<p:spacer></p:spacer>
									<h:outputText value="#{contratos.numeroContrato}"
										style="font-weight: bold;font-size: 18px;" />
									<h:outputText value="#{contratos.dataContrato}"
										style="font-weight: bold;font-size: 18px;padding-left: 50px;">
										<f:convertDateTime locale="pt_BR" />
										<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
									</h:outputText>
									<h:outputText value="#{contratos.pagador.nome}"
										style="font-weight: bold;color: #b87b2a; font-size: 18px;padding-left: 50px;" />
									<p:commandButton value="Financeiro" update="detalhesInvestidor"
											oncomplete="PF('detalheContrato').show()"
											icon="fa fa-fw fa-search"
											action="#{investidorMB.getInformacoesDoInvestidorNoContrato(contratos)}" style="margin-left: 20px;">
									</p:commandButton>
								</h:panelGrid>
							</p:outputPanel>
						</h:panelGrid>
					</p:dataViewListItem>
				</p:dataView>
			</p:panel>
		
			<p:panel id="informeRendimentos2020" header="Informe de Rendimentos - 2020"
				style="padding-top:20px; padding-bottom:20px;">				
				<h:panelGrid columns="1">
					<p:outputLabel value="Para gerar o informe de rendimentos 2020, clique no botão e faça download do PDF."
						styleClass="labelBold" />
					<p:commandButton value="Gerar PDF - Informe de Rendimentos" ajax="false"
						icon="ui-icon-print"
						action="#{investidorMB.processInformeRendimentosPortalInvestidor}"
						update="PDF:PanelPDF" />
				</h:panelGrid>
				
				<p:panel id="PanelPDF"
					header="Download do Informe de Rendimentos"
					style="margin-bottom:10px;margin-top:20px;"
					rendered="#{investidorMB.irRetidoInvestidoresPDFGerado}">
					<p:focus />
					<p:messages />
					<h:panelGrid columns="2">
						<p:dialog modal="true" widgetVar="statusDialog" header="Status"
							draggable="false" closable="false" resizable="false">
							<p:graphicImage name="image/ajaxloadingbar.gif" />
						</p:dialog>
			
						<h:form>
							<p:commandButton value="Download do Informe de Rendimentos" ajax="false"
								onclick="PrimeFaces.monitorDownload(start, stop);"
								icon="ui-icon-arrowthick-1-s">
								<p:fileDownload value="#{investidorMB.file}" />
							</p:commandButton>
						</h:form>
			
						<script type="text/javascript">
						function start() {
						    PF('statusDialog').show();
						}
						 
						function stop() {
						    PF('statusDialog').hide();
						}
						</script>
			
					</h:panelGrid>
				</p:panel>
			</p:panel>
		</h:form>
		
		<p:dialog id="detalhesInvestidorEnvelope"
			header=""
			widgetVar="detalheContratoEnvelope" modal="true" showEffect="fade"
			hideEffect="fade" resizable="false" responsive="true" width="800" positionType="absolute">
			<h:form id="formDetalhesEnvelope">
				<h:outputText
					value="#{parcelas.numeroParcela} #{parcelas.dataVencimento}"
					style="display:inline-block" />
				<p:outputPanel id="contratoDetailEnvelope" style="text-align:center; ">
					<p:dataTable id="dtParcelasEnvelope" var="parcelas" reflow="true"
						value="#{investidorMB.selectedContrato.listContratoCobrancaParcelasInvestidorSelecionadoEnvelope}"
						emptyMessage="" sortBy="#{contratos.numeroParcela}"
						sortOrder="ascending"
						rowStyleClass="#{parcelas.baixado eq true ? 'parcelaPaga' : parcelas.parcelaVencida eq true ? 'parcelaAtraso' : parcelas.parcelaVencendo eq true ? 'parcelaVencendo' : null}"
						selection="#{contratoCobrancaMB.selectedListContratoCobrancaDetalhes}"
						rowKey="#{parcelas.id}">
						
						<f:facet name="header">
							<h:outputText
								value="Contrato - #{investidorMB.selectedContrato.numeroContrato}"
								 style="font-size: 20px;"/>
						</f:facet>

						<p:column style="text-align: center;" headerText="Parcela">
							<h:outputText value="#{parcelas.numeroParcela}" />
						</p:column>
						<p:column style="text-align: center;"
							headerText="Data Vencimento Original"
							sortBy="#{parcelas.dataVencimento}">
							<h:outputText value="#{parcelas.dataVencimento}">
								<f:convertDateTime locale="pt_BR" />
								<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Valor da Parcela (R$)">
							<h:outputText value="#{parcelas.parcelaMensal}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;" headerText="Juros (R$)">
							<h:outputText value="#{parcelas.juros}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Amortização (R$)">
							<h:outputText value="#{parcelas.amortizacao}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Saldo Credor (R$)">
							<h:outputText value="#{parcelas.saldoCredorAtualizado}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;" headerText="IR Retido (R$)">
							<h:outputText value="#{parcelas.irRetido}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Valor Líquido (R$)">
							<h:outputText value="#{parcelas.valorLiquido}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>			
						<p:column style="text-align: center;"
							headerText="Valor Pago (R$)">
							<h:outputText value="#{parcelas.valorBaixado}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>			
						<p:column style="text-align: center;" headerText="Data Pagamento"
							width="100">
							<h:outputText value="#{parcelas.dataBaixa}">
								<f:convertDateTime locale="pt_BR" />
								<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>						
					</p:dataTable>
				</p:outputPanel>
			</h:form>
		</p:dialog>

		<p:dialog id="detalhesInvestidor"
			header=""
			widgetVar="detalheContrato" modal="true" showEffect="fade"
			hideEffect="fade" resizable="false" responsive="true" width="800" positionType="absolute">
			<h:form id="formDetalhes">
				<h:outputText
					value="#{parcelas.numeroParcela} #{parcelas.dataVencimento}"
					style="display:inline-block" />
				<p:outputPanel id="contratoDetail" style="text-align:center; ">
					<p:dataTable id="dtParcelas" var="parcelas" reflow="true"
						value="#{investidorMB.selectedContrato.listContratoCobrancaParcelasInvestidorSelecionado}"
						emptyMessage="" sortBy="#{contratos.numeroParcela}"
						sortOrder="ascending"
						rowStyleClass="#{parcelas.baixado eq true ? 'parcelaPaga' : parcelas.parcelaVencida eq true ? 'parcelaAtraso' : parcelas.parcelaVencendo eq true ? 'parcelaVencendo' : null}"
						selection="#{contratoCobrancaMB.selectedListContratoCobrancaDetalhes}"
						rowKey="#{parcelas.id}">
						
						<f:facet name="header">
							<h:outputText
								value="Contrato - #{investidorMB.selectedContrato.numeroContrato}"
								 style="font-size: 20px;"/>
						</f:facet>

						<p:column style="text-align: center;" headerText="Parcela">
							<h:outputText value="#{parcelas.numeroParcela}" />
						</p:column>
						<p:column style="text-align: center;"
							headerText="Data Vencimento Original"
							sortBy="#{parcelas.dataVencimento}">
							<h:outputText value="#{parcelas.dataVencimento}">
								<f:convertDateTime locale="pt_BR" />
								<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Valor da Parcela (R$)">
							<h:outputText value="#{parcelas.parcelaMensal}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;" headerText="Juros (R$)">
							<h:outputText value="#{parcelas.juros}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Amortização (R$)">
							<h:outputText value="#{parcelas.amortizacao}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Saldo Credor (R$)">
							<h:outputText value="#{parcelas.saldoCredorAtualizado}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;" headerText="IR Retido (R$)">
							<h:outputText value="#{parcelas.irRetido}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;"
							headerText="Valor Líquido (R$)">
							<h:outputText value="#{parcelas.valorLiquido}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>			
						<p:column style="text-align: center;"
							headerText="Valor Pago (R$)">
							<h:outputText value="#{parcelas.valorBaixado}"
								converter="bigDecimalConverter">
							</h:outputText>
						</p:column>			
						<p:column style="text-align: center;" headerText="Data Pagamento"
							width="100">
							<h:outputText value="#{parcelas.dataBaixa}">
								<f:convertDateTime locale="pt_BR" />
								<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>						
					</p:dataTable>
				</p:outputPanel>
			</h:form>
		</p:dialog>

		<p:dialog header="Observações" widgetVar="observacoesDialog"
			resizable="false" style="FONT-SIZE: 10pt;" width="800">
			<h:form id="formObservacoes">
				<p:panel id="ObservacoesPanel" header="Observações - Consultar"
					style="margin-top:10px;">
					<p:dataTable id="dtObservacoes" var="observacoes"
						value="#{investidorMB.selectedContratoCobrancaDetalhes.listContratoCobrancaDetalhesObservacoes}"
						paginator="true" rows="5" lazy="true"
						paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						currentPageReportTemplate="( {currentPage}   de   {totalPages} )"
						rowsPerPageTemplate="5,10" selection="" emptyMessage=""
						sortBy="#{observacoes.data}" sortOrder="descending">
						<p:column style="text-align: center;" headerText="Data Inicio"
							sortBy="#{observacoes.data}">
							<h:outputText value="#{observacoes.data}">
								<f:convertDateTime locale="pt_BR" />
								<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy HH:mm" />
							</h:outputText>
						</p:column>
						<p:column style="text-align: center;" headerText="Usuário"
							filterBy="#{observacoes.usuario}" filterMatchMode="contains"
							sortBy="#{observacoes.usuario}">
							<h:outputText value="#{observacoes.usuario}" />
						</p:column>
						<p:column style="text-align: center;" headerText="Observação"
							filterBy="#{observacoes.observacao}" filterMatchMode="contains"
							sortBy="#{observacoes.observacao}">
							<h:outputText value="#{observacoes.observacao}" />
						</p:column>
					</p:dataTable>
				</p:panel>
				<div align="center" style="margin-top: 20px; margin-bottom: 20px;">
					<p:commandButton value="Voltar"
						image="ui-icon-arrowreturnthick-1-w"
						oncomplete="PF('observacoesDialog').hide();" />
				</div>
			</h:form>
		</p:dialog>
	</div>
	<footer id="footer" class="footer-area">
	<div class="footer-copyright">
		<div class="container">
			<p style="color: #fff; text-align: center !important;">
				<a href="http://www.galleriafinancas.com.br" target="_blank">Galleria
					Finanças</a>
			</p>
		</div>
		<!-- container -->
	</div>
	<!-- footer copyright --> </footer>
</h:body>
</html>