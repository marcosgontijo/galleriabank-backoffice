<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:shiro="http://shiro.apache.org/tags">


	<h:outputStylesheet>
			.painelResumo{
				vertical-align: top;
				
			}
			
	</h:outputStylesheet>
	<shiro:hasAnyRoles
		name="ROOT,PRECOBRANCAANALISTA,COBRANCA_FINANCEIRO, PROFILE_ANALISTA_CREDITO">
		<p:panel id="ArquivosAnalisados"
			style="margin-bottom:10px;text-align: center;" rendered="#{contratoCobrancaMB.tituloTelaConsultaPreStatus != 'Ag. DOC' 
			and contratoCobrancaMB.tituloTelaConsultaPreStatus != 'Ag. Registro' 
			and contratoCobrancaMB.tituloTelaConsultaPreStatus != 'Pré-Comite' }">
			<f:facet name="header">
				<h:outputText value="Analise Documentos" />
				<p:commandButton value="Atualizar listagem" ajax="true"
					update="ArquivosAnalisados" style="margin-left:10px;"
					action="#{contratoCobrancaMB.listaArquivosAnaliseDocumentos}"
					immediate="true" icon="ui-icon-search">
				</p:commandButton>
			</f:facet>

			<h:panelGrid columns="1">
				<p:fileUpload label="Selecionar Arquivo"				
					rendered="#{contratoCobrancaMB.objetoContratoCobranca.emAnalise}"
					uploadLabel="Salvar Arquivo" multiple="false"
					cancelLabel="Cancelar"
					fileUploadListener="#{contratoCobrancaMB.handleAnaliseDocumentoFileUpload}"
					mode="advanced" dragDropSupport="true" update="dtFilesAnalise">
					<f:attribute name="foo"
						value="#{contratoCobrancaMB.contasPagarSelecionada}" />
				</p:fileUpload>
			</h:panelGrid>

			<p:panel id="ArquivosSalvosAnalise"
				header="Arquivo(s) Salvo(s) na analise" style="margin-bottom:10px;">
				<f:facet name="header"> Arquivo(s) Salvo(s) na analise 
							<p:outputLabel value="" />
					<p:commandButton value="Adicionar Pessoa"
						rendered="#{contratoCobrancaMB.objetoContratoCobranca.emAnalise}"
						action="#{contratoCobrancaMB.preparaAdicionarPessoaAnalise}"
						oncomplete="PF('adicionarPessoaAnaliseDlg').show();"
						update="adicionarPessoaAnaliseForm">
					</p:commandButton>
				</f:facet>


				<h:panelGrid columns="1">
					<p:dataTable id="dtFilesAnalise" var="fileAnalise"
						value="#{contratoCobrancaMB.listaDocumentoAnalise}"
						rowKey="#{fileAnalise.id}" emptyMessage="">

						<p:column style="text-align: center; width:5rem;">

							<p:commandButton value="ver Resumo"
								onclick="PF('resumoConsutlasDialog').show()"
								update="resumoConsutlasForm" ajax="true"
								style="TEXT-DECORATION: bold;" rendered="#{fileAnalise.engineProcessado}">

								<f:setPropertyActionListener value="#{fileAnalise}"
									target="#{contratoCobrancaMB.documentoAnalisePopup}"></f:setPropertyActionListener>
							</p:commandButton>

						</p:column>

						<p:column headerText="Liberado Análise">
							<p:selectBooleanButton value="#{fileAnalise.liberadoAnalise}"
								rendered="#{contratoCobrancaMB.objetoContratoCobranca.emAnalise}"
								onLabel="Sim" offLabel="Não" style="width:6rem">
								<p:ajax event="change"
									listener="#{contratoCobrancaMB.marcaParaDocumentoAnalise(fileAnalise)}" />
							</p:selectBooleanButton>
							<p:selectBooleanButton value="#{fileAnalise.liberadoAnalise}"
								rendered="#{!contratoCobrancaMB.objetoContratoCobranca.emAnalise}"
								disabled="true" onLabel="Sim" offLabel="Não" style="width:6rem">
							</p:selectBooleanButton>
						</p:column>


						<p:column style="text-align: center;" headerText="Identificação"
							filterBy="#{fileAnalise.identificacao}"
							filterMatchMode="contains" sortBy="#{fileAnalise.identificacao}">

							<h:outputText value="#{fileAnalise.identificacao}"
								rendered="#{fileAnalise.podeChamarRea}" />
							<h:outputText
								value="#{fileAnalise.identificacao} #{fileAnalise.cnpjcpf} "
								rendered="#{!fileAnalise.podeChamarRea}" />
							<p:spacer height="10" />
						</p:column>

						<p:column style="text-align: center;" headerText="Motivo"
							filterMatchMode="contains">
							<h:outputText value="#{fileAnalise.motivoAnalise}" />
						</p:column>

						<p:column style="text-align: center;" headerText="Observação"
							filterMatchMode="contains">
							<h:outputText value="#{fileAnalise.observacao}" />
						</p:column>

						<p:column style="text-align: center;" headerText="Situação"
							filterMatchMode="contains">

							<h:outputText value="REA Enviado"
								rendered="#{fileAnalise.podeChamarRea and !fileAnalise.reaNaoEnviado and !fileAnalise.reaProcessado }" />
							<h:outputText value="REA Processado"
								rendered="#{fileAnalise.podeChamarRea and fileAnalise.reaProcessado }" />

							<p:commandButton
								action="#{contratoCobrancaMB.baixarEngineDocumento(fileAnalise)}"
								icon="ui-icon ui-icon-print" value="Download Engine"
								rendered="#{!fileAnalise.podeChamarEngine and fileAnalise.engineProcessado }"
								ajax="false" />

							<p:commandButton
								action="#{serasaMB.baixarDocumento(fileAnalise)}"
								icon="ui-icon ui-icon-print" value="Download Serasa"
								rendered="#{fileAnalise.serasaProcessado }" ajax="false" />

							<p:commandButton
								action="#{netrinMB.baixarDocumento(fileAnalise)}"
								icon="ui-icon ui-icon-print" value="Download Cenprot"
								rendered="#{fileAnalise.cenprotProcessado }" ajax="false" />

							<p:commandButton
								action="#{netrinMB.baixarDocumentoPpe(fileAnalise)}"
								icon="ui-icon ui-icon-print" value="Download PPE"
								rendered="#{fileAnalise.ppeProcessado }" ajax="false" />

							<p:commandButton
								action="#{netrinMB.baixarDocumentoDossie(fileAnalise)}"
								icon="ui-icon ui-icon-print" value="Download Dossiê"
								rendered="#{fileAnalise.podeDownlaodDossie }" ajax="false" />

							<p:commandButton
								action="#{netrinMB.baixarDocumentoProcesso(fileAnalise)}"
								icon="ui-icon ui-icon-print" value="Download Processos"
								rendered="#{fileAnalise.processoProcessado }" ajax="false" />

							<p:commandButton
								action="#{bmpDigitalMB.baixarDocumento(fileAnalise)}"
								icon="ui-icon ui-icon-print" value="Download SCR"
								rendered="#{fileAnalise.scrProcessado }" ajax="false" />


						</p:column>

						<p:column style="width:100px;" rendered="#{false}">
							<p:commandButton value="Download" ajax="false"
								icon="ui-icon-arrowthick-1-s">
								<f:setPropertyActionListener
									target="#{contratoCobrancaMB.selectedFile}"
									value="#{fileAnalise}" />
								<p:fileDownload value="#{contratoCobrancaMB.downloadFile}" />
							</p:commandButton>
						</p:column>
					</p:dataTable>
				</h:panelGrid>

			</p:panel>
			<p:panel id="pnlCeridoesAnalise" header="Certidões"
				rendered="#{contratoCobrancaMB.objetoContratoCobranca.emAnalise}"
				style="margin-bottom:10px;">

				<p:commandButton value="Executar Consultas"
					action="#{contratoCobrancaMB.executarConsultasAnaliseDocumento}"
					ajax="true" />
				<p:commandButton value="Certidões Docket"
					action="#{docketMB.clearFieldsContratoCobranca(contratoCobrancaMB.objetoContratoCobranca)}" />
			</p:panel>
		</p:panel>

	</shiro:hasAnyRoles>
</ui:composition>
