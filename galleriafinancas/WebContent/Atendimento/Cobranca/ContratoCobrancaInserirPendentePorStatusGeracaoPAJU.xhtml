<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
			    xmlns:ui="http://java.sun.com/jsf/facelets"
			    xmlns:f="http://java.sun.com/jsf/core"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:p="http://primefaces.org/ui"
				xmlns:shiro="http://shiro.apache.org/tags"
			    template="/Menus/Menu.xhtml">
	<ui:define name="conteudo">  
		<h:form id="form">		
		 	<script src="#{request.contextPath}/resources/js/functions.js"></script>
		 	<script src="#{request.contextPath}/resources/js/locale-primefaces.js" library="javascript"></script>			
		 	<link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/css/Style.css" title="" media="all" /> 	
		 	<script src=".#{request.contextPath}/resources/js/jquery.mask.min.js"></script>	
			<script>
		        function validatePhone() {
		
		            var masks = ['(00) 00000-0000', '(00) 0000-00009'],
		                maskBehavior = function(val, e, field, options) {
		                    return val.length > 14 ? masks[0] : masks[1];
		                };
		
		            $('.phone').mask(maskBehavior, {onKeyPress:
		                        function(val, e, field, options) {
		                            field.mask(maskBehavior(val, e, field, options), options);
		                        }
		            });
		        }
		        $(document).ready(function() {
		            validatePhone();
		        }
		        );
			</script>
			
			<h:outputStylesheet >
			.labelSeguros{
				width: 128px;
			}
			.ValorSeguros{
				width: 100px;
			}
			</h:outputStylesheet>
			<ui:include src="ContratoCobrancaAnaliseDocumento.xhtml"></ui:include>
				
			<p:panel id="PanelLocador" header="Contrato - #{contratoCobrancaMB.tituloPainel}" style="margin-bottom:10px;">
				<p:focus /> 
				<p:messages/>
				
				<h:panelGrid columns="2">	
					<p:outputLabel for="numeroContrato" value="Número do Contrato: " styleClass="labelBold" style="width:250px;font-weight: bold; font-size: 18px;"/>
					<h:outputText id="numeroContrato" value="#{contratoCobrancaMB.objetoContratoCobranca.numeroContrato}"  autocomplete="no" label="Número do Contrato" style="font-weight: bold; font-size: 18px;"/>								
					<p:outputLabel for="dataContrato" value="Data do Contrato: " styleClass="labelBold" style="width:250px;font-weight: bold; font-size: 18px;"/>
					<h:outputText id="dataContrato" value="#{contratoCobrancaMB.objetoContratoCobranca.dataContrato}"  autocomplete="no" style="width:250px;font-weight: bold; font-size: 18px;">			            	
				          <f:convertDateTime locale="pt_BR"  />
				          <f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy"/>
				    </h:outputText>																				
				</h:panelGrid>

				<h:panelGroup id="RecebidoPajulaudoPanel"
					style="margin-bottom:20px;">
					<p:panel rendered="#{contratoCobrancaMB.objetoContratoCobranca.cadastroAprovadoValor == 'Aprovado'}" header="Recebido PAJU e laudo">						
						<h:panelGrid columns="2"
							rendered="#{contratoCobrancaMB.objetoContratoCobranca.pajurFavoravel == true}">
							<p:outputLabel for="comentarioJuridico"
								value="Comentario Juridico: " styleClass="labelBold" />
							<p:inputTextarea id="comentarioJuridico" rows="10" cols="48"
								counter="display" maxlength="3000" onblur=""
								counterTemplate="{0} characters remaining." autoResize="false"
								value="#{contratoCobrancaMB.objetoContratoCobranca.comentarioJuridico}" />
							<p:outputLabel id="display" />
						</h:panelGrid>
					</p:panel>
				</h:panelGroup>
				
				<h:panelGroup id="CheckListInformacoesAdicionais" rendered="#{!contratoCobrancaMB.objetoContratoCobranca.reanalisePronta}">
					<p:panel header="Check-List - Informações Adicionais"
						style="margin-bottom:20px;" rendered="#{contratoCobrancaMB.objetoContratoCobranca.cadastroAprovadoValor == 'Aprovado'}">		
						<p:spacer height="10"></p:spacer>
						<p:panel id="StatusGeracaoLaudo" style="border: none">
							<h:panelGrid columns="4">
								<p:outputLabel styleClass="labelBold">Geração PAJU Iniciada? </p:outputLabel>									
								<p:selectBooleanButton id="statusPAJU" value="#{contratoCobrancaMB.objetoContratoCobranca.iniciouGeracaoPaju}" 
											onLabel="Iniciado" offLabel="Não Iniciado" onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:=80px"/>
											

								<p:commandButton value="Download Modelo PAJU" ajax="false"
									icon="ui-icon-check"
									action="#{contratoCobrancaMB.downloadModeloPaju}"
									style="TEXT-DECORATION: bold; width: 170px; height: 55px;">
								</p:commandButton>
								
								<p:commandButton value="Atualizar Status" ajax="false" icon="ui-icon-check" action="#{contratoCobrancaMB.editPreContratoPorStatus()}" style="TEXT-DECORATION: bold; width: 170px; height: 55px;" rendered="#{contratoCobrancaMB.updateMode}">
									<f:setPropertyActionListener target="#{contratoCobrancaMB.preContratoCustom}" value="false" />	
								</p:commandButton>
							</h:panelGrid>	
							<h:panelGrid columns="2">
								<p:outputLabel for="geracaoLaudo"
									value="Observação PAJU: " styleClass="labelBold" />
								<p:inputTextarea id="geracaoLaudo" rows="5"
									cols="84" maxlength="3000" onblur=""
									counterTemplate="{0} characters remaining." autoResize="false"
									value="#{contratoCobrancaMB.objetoContratoCobranca.geracaoLaudoObservacao}" />
							</h:panelGrid>
							<h:panelGrid columns="3">
								<p:outputLabel styleClass="labelBold">PAJU Gerado: </p:outputLabel>									
											<p:selectBooleanButton id="pedirPajuBtn" value="#{contratoCobrancaMB.objetoContratoCobranca.pajurFavoravel}" 
											onLabel="Gerado" offLabel="Não Gerado" onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:=80px"/>
								<p:commandButton value="Atualizar Check-List" ajax="false" icon="ui-icon-check" action="#{contratoCobrancaMB.editPreContratoPorStatus()}" style="TEXT-DECORATION: bold; width: 170px; height: 55px;" rendered="#{contratoCobrancaMB.updateMode}">
									<f:setPropertyActionListener target="#{contratoCobrancaMB.preContratoCustom}" value="false" />	
								</p:commandButton>
							</h:panelGrid>	
						</p:panel>
					</p:panel>
				</h:panelGroup>			
													
				<h:panelGroup id="CheckListReanalise" rendered="#{contratoCobrancaMB.objetoContratoCobranca.reanalisePronta}">
					<p:panel header="Check-List - REANALISE"
						style="margin-bottom:20px;">		
						<p:spacer height="10"></p:spacer>
						<p:panel id="StatusGeracaoLaudoReanalise" style="border: none">
							<h:panelGrid columns="4">
								<p:commandButton value="Download Modelo PAJU" ajax="false"
									icon="ui-icon-check"
									action="#{contratoCobrancaMB.downloadModeloPaju}"
									style="TEXT-DECORATION: bold; width: 170px; height: 55px;">
								</p:commandButton>
								
								<p:commandButton value="Atualizar Status" ajax="false" icon="ui-icon-check" action="#{contratoCobrancaMB.editPreContratoPorStatus()}" style="TEXT-DECORATION: bold; width: 170px; height: 55px;" rendered="#{contratoCobrancaMB.updateMode}">
									<f:setPropertyActionListener target="#{contratoCobrancaMB.preContratoCustom}" value="false" />	
								</p:commandButton>
							</h:panelGrid>	
							<h:panelGrid columns="2">
								<p:outputLabel for="geracaoLaudoReanalise"
									value="Observação PAJU: " styleClass="labelBold" />
								<p:inputTextarea id="geracaoLaudoReanalise" rows="5"
									cols="84" maxlength="3000" onblur=""
									counterTemplate="{0} characters remaining." autoResize="false"
									value="#{contratoCobrancaMB.objetoContratoCobranca.geracaoLaudoObservacao}" />
							</h:panelGrid>
							<h:panelGrid columns="3">
								<p:outputLabel styleClass="labelBold">PAJU Reanalise Gerado: </p:outputLabel>									
											<p:selectBooleanButton id="pedirPajuReanaliseBtn" value="#{contratoCobrancaMB.objetoContratoCobranca.pajuAtualizado}" 
											onLabel="Gerado" offLabel="Não Gerado" onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:=80px"/>
								<p:commandButton value="Atualizar Check-List" ajax="false" icon="ui-icon-check" action="#{contratoCobrancaMB.editPreContratoPorStatus()}" 
									style="TEXT-DECORATION: bold; width: 170px; height: 55px;" rendered="#{contratoCobrancaMB.updateMode}">
									<f:setPropertyActionListener target="#{contratoCobrancaMB.preContratoCustom}" value="false" />	
								</p:commandButton>
							</h:panelGrid>	
						</p:panel>
					</p:panel>
				</h:panelGroup>
			
				<!-- painel do inserir imovel-->
				<ui:include src="ContratoCobrancaInserirImovel.xhtml"></ui:include>
				
				<p:panel id="Infos" header="Outras Informações"
					style="margin-bottom:10px;">
					<h:panelGrid columns="2">
						<h:panelGrid columns="2">
							<p:outputLabel for="quantoPrecisa" value="Qual valor precisa? "
								styleClass="labelBold" />
							<p:inputText id="quantoPrecisa"
								value="#{contratoCobrancaMB.objetoContratoCobranca.quantoPrecisa}"
								onkeypress="return isNumberKey(event);"
								onkeydown="FormataValor(this, 13, event, 2);" required="true"
								converter="bigDecimalConverter" />
								
							<p:outputLabel for="tipoOperacao" value="Tipo da Operação" styleClass="labelBold" />
							<p:selectOneRadio id="tipoOperacao" unselectable="true" required="true" columns="1"
								layout="responsive" value="#{contratoCobrancaMB.objetoContratoCobranca.tipoOperacao}">
								<f:selectItem itemLabel="Home Equity" itemValue="Home Equity" />
								<f:selectItem itemLabel="Financiamento com aquisição imóvel" itemValue="Emprestimo" />
								<p:ajax update="compraVenda" event="change"/>
							</p:selectOneRadio>
						</h:panelGrid>
						
						<h:panelGroup id="compraVenda">
							<h:panelGrid columns="2" rendered="#{contratoCobrancaMB.objetoContratoCobranca.tipoOperacao == 'Emprestimo'}">
								<p:outputLabel for="valorCompraVenda" value="Valor de Compra e Venda"
									styleClass="labelBold" />
								<p:inputText id="valorCompraVenda" 
									value="#{contratoCobrancaMB.objetoContratoCobranca.valorCompraVenda}"
									onkeypress="return isNumberKey(event);"
									onkeydown="FormataValor(this, 13, event, 2);" 
									converter="bigDecimalConverter" />
									
								<p:outputLabel for="recebedorCompraVenda" value="Recebedor"
									styleClass="labelBold" />							
								<p:selectOneMenu id="recebedorCompraVenda"
									value="#{contratoCobrancaMB.objetoContratoCobranca.recebedorCompraVenda}" ajax="true">
									<f:selectItem itemValue="Vendedor" itemLabel="Vendedor" />							
									<f:selectItem itemValue="Comprador" itemLabel="Comprador" />	
								</p:selectOneMenu>
							</h:panelGrid>
						</h:panelGroup>
					</h:panelGrid>
				</p:panel>																																																					
			</p:panel>
			
			<p:messages id="msgArquivo"/>
			
			<p:panel id="UploadArquivosInternos" header="" style="margin-bottom:10px;">										
				<p:dialog modal="true" widgetVar="statusDialog" header="Status Downloading" draggable="false" closable="false" resizable="false">
				    <p:graphicImage name="image/ajaxloadingbar.gif" />
				</p:dialog>

				<p:panel id="ArquivosInternosSalvos" header="Arquivo(s) Salvo(s) no Contrato" style="margin-bottom:10px;">							
					<h:panelGrid columns="1">			                      								
						<p:dataTable id="dtFilesInterno" var="filesInterno" value="#{contratoCobrancaMB.filesInterno}" rowKey="#{filesInterno.name}" selection="#{contratoCobrancaMB.deletefilesInterno}" emptyMessage="" sortBy="#{filesInterno.name}" >	
							<p:column selectionMode="multiple" style="width:16px;text-align:center"/>
							 <f:facet name="header">
								<p:commandButton value="Download Selecionado(s)" ajax="false"
									immediate="true" action="#{contratoCobrancaMB.getDownloadAllFilesInterno()}"
									icon="ui-icon-arrowthick-1-s">
								</p:commandButton>					 
					        </f:facet>	        
					        <p:column style="text-align: center;"
								headerText="Nome do Arquivo" filterBy="#{filesInterno.name}"
								filterMatchMode="contains" sortBy="#{filesInterno.name}">
								<h:outputText
								
										value="#{filesInterno.name}" />
								<p:spacer height="10" />
								<p:commandButton value="Abrir" ajax="false" action="#{contratoCobrancaMB.viewFile(filesInterno)}"
									immediate="true" icon="ui-icon-search" onclick="target='_blank'" onblur="target='_self'">
								</p:commandButton>
							</p:column>  
					        
					        <p:column style="width:100px;">
								<p:commandButton value="Download" ajax="false"  icon="ui-icon-arrowthick-1-s">						       	 	
						       	 	<f:setPropertyActionListener target="#{contratoCobrancaMB.selectedFile}" value="#{filesInterno}" />
						       	 	<p:fileDownload value="#{contratoCobrancaMB.downloadFile}" />
						    	</p:commandButton>	
				            </p:column>						        

				             <f:facet name="footer">
								<p:commandButton value="Download Selecionado(s)" ajax="false"  icon="ui-icon-arrowthick-1-s">						       	 	
						       	 	<p:fileDownload value="#{contratoCobrancaMB.downloadAllFilesInterno}" />
						    	</p:commandButton>					          														
					        </f:facet> 
					        <p:ajax event="rowSelectCheckbox" update="dtFilesInterno" 
								process="@this" listener="#{contratoCobrancaMB.fileSelectionListener()}"/>
							<p:ajax event="rowUnselectCheckbox" update="dtFilesInterno" 
								process="@this" listener="#{contratoCobrancaMB.fileSelectionListener()}"/>
							<p:ajax event="toggleSelect" update="dtFilesInterno" 
								process="@this" listener="#{contratoCobrancaMB.fileSelectionListener()}"/>	            	        		               		        			        			           			 		
						</p:dataTable>								
					</h:panelGrid>  
				</p:panel>
				<script type="text/javascript">
					function start() {
					    PF('statusDialog').show();
					}
					 
					function stop() {
					    PF('statusDialog').hide();
					}
				</script>
			</p:panel>			
			
			<p:panel id="UploadArquivosJuridico" header="Upload de Arquivo Juridico(s)" style="margin-bottom:10px;" >						
				<p:panel id="ArquivosJuridico" header="Selecionar Arquivo Juridico(s)" style="margin-bottom:10px;text-align: center;">							
					<h:panelGrid columns="1">		
						<p:fileUpload label="Selecionar Arquivo(s)" uploadLabel="Salvar Arquivo(s)" multiple="true" cancelLabel="Cancelar" fileUploadListener="#{contratoCobrancaMB.handleFileJuridicoUpload}" mode="advanced" dragDropSupport="true"
                          update="ArquivosJuridicoSalvos msgArquivo" />								
					</h:panelGrid>  
				</p:panel>	
				
				<p:dialog modal="true" widgetVar="statusDialog" header="Status Downloading" draggable="false" closable="false" resizable="false">
				    <p:graphicImage name="image/ajaxloadingbar.gif" />
				</p:dialog>

				<p:panel id="ArquivosJuridicoSalvos" header="Arquivo(s) Juridico Salvo(s) no Contrato" style="margin-bottom:10px;">							
					<h:panelGrid columns="1">			                      								
						<p:dataTable id="dtFilesJuridico" var="filesJuridico" value="#{contratoCobrancaMB.filesJuridico}" rowKey="#{filesJuridico.name}" selection="#{contratoCobrancaMB.deletefilesJuridico}" emptyMessage="" sortBy="#{filesJuridico.name}" >	
							<p:column selectionMode="multiple" style="width:16px;text-align:center"/>
							 <f:facet name="header">							 
								<p:commandButton value="Excluir Selecionado(s)" ajax="false" icon="ui-icon-trash" action="#{contratoCobrancaMB.deleteFileJuridico}"/>
								<p:commandButton value="Download selecionados" ajax="false">
								<p:commandButton value="Download Selecionado(s)" ajax="false"
										icon="ui-icon-arrowthick-1-s" immediate="true"
										action="#{contratoCobrancaMB.getDownloadAllFilesJuridico()}">
									</p:commandButton>	
								</p:commandButton>
					        </f:facet>	        
					        <p:column style="text-align: center;"
								headerText="Nome do Arquivo" filterBy="#{filesJuridico.name}"
								filterMatchMode="contains" sortBy="#{filesJuridico.name}">
								<h:outputText
								
										value="#{filesJuridico.name}" />
								<p:spacer height="10" />
								<p:commandButton value="Abrir" ajax="false" action="#{contratoCobrancaMB.viewFile(filesJuridico)}"
									immediate="true" icon="ui-icon-search" onclick="target='_blank'" onblur="target='_self'">
								</p:commandButton>
							</p:column>  
					        
					        <p:column style="width:100px;">
								<p:commandButton value="Download" ajax="false"  icon="ui-icon-arrowthick-1-s">						       	 	
						       	 	<f:setPropertyActionListener target="#{contratoCobrancaMB.selectedFile}" value="#{filesJuridico}" />
						       	 	<p:fileDownload value="#{contratoCobrancaMB.downloadFile}" />
						    	</p:commandButton>	
				            </p:column>						        

				             <f:facet name="footer">	             
								<p:commandButton value="Excluir Selecionado(s)" ajax="false" icon="ui-icon-trash" action="#{contratoCobrancaMB.deleteFileJuridico}"/>								
					        </f:facet>    
					        <p:ajax event="rowSelectCheckbox" process="@this"
								listener="#{contratoCobrancaMB.fileSelectionListener()}" />
							<p:ajax event="rowUnselectCheckbox" process="@this"
								listener="#{contratoCobrancaMB.fileSelectionListener()}" />
							<p:ajax event="toggleSelect" process="@this"
								listener="#{contratoCobrancaMB.fileSelectionListener()}" />         	        		               		        			        			           			 		
						</p:dataTable>								
					</h:panelGrid>  
				</p:panel>
				<script type="text/javascript">
					function start() {
					    PF('statusDialog').show();
					}
					 
					function stop() {
					    PF('statusDialog').hide();
					}
				</script>
			</p:panel>	
					
			<div align="center">
				<p:commandButton value="Atualizar" ajax="false" icon="ui-icon-check" action="#{contratoCobrancaMB.atualizaContratoGeracaoPAJU()}" style="TEXT-DECORATION: bold;" rendered="#{contratoCobrancaMB.updateMode}">
					<f:setPropertyActionListener target="#{contratoCobrancaMB.preContratoCustom}" value="false" />	
				</p:commandButton>		 						
				<p:commandButton value="Cancelar" immediate="true" icon="ui-icon-cancel" onclick="window.history.back();" style="TEXT-DECORATION: bold; "/>								
			</div>			
		</h:form>
			<ui:include src="ContratoCobrancaAnaliseDocumentoResumoPopup.xhtml"></ui:include>
			
			<ui:include src="../../Dialog/DialogRecebedorPagador.xhtml">
				<ui:param name="mbean" value="#{contratoCobrancaMB}"></ui:param>
				<ui:param name="titulo" value="#{contratoCobrancaMB.tituloPagadorRecebedorDialog}"></ui:param>
				<ui:param name="permiteAdicionarPessoa" value="false"></ui:param>			
			</ui:include>
	</ui:define>
</ui:composition>
