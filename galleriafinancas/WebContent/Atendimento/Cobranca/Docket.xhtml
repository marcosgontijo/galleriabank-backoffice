<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:shiro="http://shiro.apache.org/tags"
	template="../MenuAtendimento.xhtml">
	
	<ui:define name="conteudo">
		<h:form id="form">
			<script src="#{request.contextPath}/resources/resources/js/functions.js"></script>
			<script src="#{request.contextPath}/resources/js/locale-primefaces.js" library="javascript"></script>
			<link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/resources/css/Style.css" title="" media="all" />
			
			<p:panel id="DocketPanel" header="Docket"
				style="margin-bottom:10px;">
				<p:focus />
				<p:messages />
				<p:messages id="msgs" />	
				<h:panelGrid columns="2">		
					<h:panelGrid columns="2">							
						<p:outputLabel for="contrato" value="Referente a Operação: "
							styleClass="labelBold"
							style="font-weight: bold; font-size: 18px;" />
						<h:panelGroup>
							<p:outputLabel id="contrato" disabled="true"
								value="#{docketMB.objetoContratoCobranca.numeroContrato}"
								required="false" style="FONT-SIZE: 10pt;" />
							<p:spacer height="10" />
							<p:commandButton icon="ui-icon ui-icon-circle-zoomin" ajax="true"
								action="#{docketMB.pesquisaContratoCobranca}"
								disabled="#{docketMB.objetoContratoCobranca.numeroContrato ne null}"
								oncomplete="PF('contratoCobrancaDialog').show();"
								update="contrato contratoDialogdlg" />
						</h:panelGroup>
						
						<p:outputLabel value="Adicionar Pagadores: "
							styleClass="labelBold"
							style="font-weight: bold; font-size: 18px;" />
						<p:commandButton action="#{docketMB.pesquisaPagadorRecebedor}"
							icon="ui-icon ui-icon-plus" ajax="true"
							oncomplete="PF('pagadorRecebedorDialog').show();"
							update="formReceborPagador" />
					</h:panelGrid>
					<h:panelGrid columns="2">	
						<p:outputLabel value="Estado" style="FONT-SIZE: 10pt;" />
						<h:selectOneMenu value="#{docketMB.estadoSelecionadoImovel}" >								
							<f:selectItems value="#{docketMB.listaEstados}" var="estado"
								itemValue="#{estado}" itemLabel="#{estado}" />		
							<p:ajax update="cidadesImovel" event="change" listener="#{docketMB.getListaCidadesImovel}"/>										
						</h:selectOneMenu>
						<p:outputLabel value="Cidade" style="FONT-SIZE: 10pt;" />
						<p:autoComplete id="cidadesImovel" value="#{docketMB.cidadeImovel}"
							completeMethod="#{docketMB.completeCidadesImovel}" autocomplete="no" 
							var="cidade" itemLabel="#{cidade}" itemValue="#{cidade}"  dropdown="true"
							forceSelection="true"
							scrollHeight="250" >
							<p:ajax update="Dados" event="itemSelect" listener="#{docketMB.atualizaTodosDocumentos}" /> 
						</p:autoComplete>
					</h:panelGrid>
				</h:panelGrid>	
				
				<h:panelGroup id="Dados">				
					<ui:repeat var="pagador" value="#{docketMB.listaPagador}" style="width:50%;">
						<p:panel id="pagadorPanel" header="#{pagador.nome}" style="padding: none" 
							toggleable="true" toggleableHeader="true">
							<f:facet name="header" styleClass="ui-accordion-header">
								<p:commandButton icon="ui-icon ui-icon-trash"
									action="#{docketMB.removerPessoa(pagador)}"
									ajax="true" update=":form:DocketPanel" />
								<p:outputLabel value="#{pagador.nome}" style="FONT-SIZE: 15pt;margin-left: 5px" styleClass="ui-panel-title"/>
							</f:facet>
							<h:panelGrid columns="2">					
								<p:commandButton icon="ui-icon ui-icon-plus"
									action="#{docketMB.clearDialogDoc(pagador)}"
									oncomplete="PF('documentosDialog').show();"
									ajax="true" update="documentosform" />								
								<h:panelGroup rendered="#{pagador.cpf != null and pagador.cpf != ''}">
									<p:outputLabel value="Nome:" style="FONT-SIZE: 5pt; margin-right: 5px" styleClass="labelBold"/>
									<p:outputLabel value="#{pagador.nome}" style="FONT-SIZE: 5pt; margin-right: 5px"  />  								
									<p:outputLabel value="| CPF:" style="FONT-SIZE: 5pt; margin-right: 5px" styleClass="labelBold"/>
									<p:inputText value="#{pagador.cpf}" style="FONT-SIZE: 5pt; margin-right: 5px; width:100px" />  								
									<p:outputLabel value="| Mãe:" style="FONT-SIZE: 5pt; margin-right: 5px" styleClass="labelBold"/>
									<p:inputText value="#{pagador.nomeMae}" style="FONT-SIZE: 5pt; margin-right: 5px; width:100px" /> 							 
									<p:outputLabel value="| RG:" style="FONT-SIZE: 5pt; margin-right: 5px" styleClass="labelBold"/>
									<p:inputText value="#{pagador.rg}" style="FONT-SIZE: 5pt; margin-right: 5px; width:100px" /> 								
									<p:outputLabel value="| Data Nascimento:" style="FONT-SIZE: 5pt; margin-right: 5px" styleClass="labelBold"/>
									<p:calendar value="#{pagador.dtNascimento}" size="50" styleClass="dateTimeField" pattern="dd/MM/yyyy" 
										inputStyle="margin-right: 5px; width:70px"/>							
								</h:panelGroup> 						
								<h:panelGroup rendered="#{pagador.cpf eq null or pagador.cpf eq ''}">
									<p:outputLabel value="Razão Social:" style="FONT-SIZE: 5pt; margin-right: 5px" styleClass="labelBold"/>
									<p:outputLabel value="#{pagador.nome}" style="FONT-SIZE: 5pt; margin-right: 5px" />  							
									<p:outputLabel value="| CNPJ:" style="FONT-SIZE: 5pt; margin-right: 5px" styleClass="labelBold"/>
									<p:inputText value="#{pagador.cnpj}" style="FONT-SIZE: 5pt; margin-right: 5px; width:120px" />  						
								</h:panelGroup> 						    
							</h:panelGrid>	
							<p:panel id="docsPanel" header="Documentos - #{pagador.documentosDocket.size()}" style="padding: 0" toggleable="true" toggleableHeader="true" >
								 <p:dataList id="docsList" value="#{pagador.documentosDocket}" var="docs" style="padding: 0" type="definition">
								 	<p:panel id="PanelGridDocs" header="Documentos" style="padding: 0" toggleable="true" toggleableHeader="true" collapsed="true" >			
										<f:facet name="header" styleClass="ui-accordion-header">
											<p:commandButton icon="ui-icon ui-icon-trash"
												action="#{docketMB.removeDoc(pagador, docs)}"
												 update=":form:DocketPanel" />
											<p:outputLabel value="#{docs.documentoDocket.documentoNome}" style="FONT-SIZE: 15pt;margin-left: 5px" styleClass="ui-panel-title"/>
										</f:facet>
										<h:panelGrid columns="4">		
											<p:outputLabel value="Estado" style="FONT-SIZE: 10pt;" />
	    									<h:selectOneMenu value="#{docs.estadoSelecionado}" >								
												<f:selectItems value="#{docketMB.listaEstados}" var="estado"
		    										itemValue="#{estado}" itemLabel="#{estado}" />		
		    									<p:ajax update="docsList" event="change" listener="#{docketMB.getListaCidades(docs)}"/>										
	    									</h:selectOneMenu>
												
											<p:outputLabel value="Cidade" style="FONT-SIZE: 10pt;" />
											<p:autoComplete value="#{docs.cidade}"
												completeMethod="#{docketMB.completeCidades}" autocomplete="no" 
												var="cidade" itemLabel="#{cidade}" itemValue="#{cidade}"
												forceSelection="true" styleClass="labelBold" style="width:100px;"
												scrollHeight="250" >
												<p:ajax update="cidadeID" event="blur" listener="#{docs.getCidadeDocketId}" />
												<f:attribute name="documentoAtual" value="#{docs}" />	
											</p:autoComplete>
										</h:panelGrid>
										<h:panelGrid columns="2">	
											<p:outputLabel id="estadoID" value="#{docs.estadoId}" style="FONT-SIZE: 10pt;" />
											<p:outputLabel id="cidadeID" value="#{docs.cidadeId}" style="FONT-SIZE: 10pt;" />
										</h:panelGrid>	
									</p:panel>	
								 </p:dataList>
							</p:panel>
						</p:panel>
					</ui:repeat>
				</h:panelGroup>
			
				<h:panelGrid columns="3">	
					<p:commandButton action="#{docketMB.criarPedido}"
						icon="ui-icon ui-icon-print" value="Fazer Pedido"  update=":form  msgs" />			
				</h:panelGrid>
			</p:panel>
			
		</h:form>
	
		<ui:include src="../../Dialog/DialogRecebedorPagador.xhtml">
			<ui:param name="mbean" value="#{docketMB}"></ui:param>
			<ui:param name="titulo" value="Pagador"></ui:param>
		</ui:include>
		
		<p:dialog header="Documentos" widgetVar="documentosDialog"
			resizable="true" style="FONT-SIZE: 10pt;" width="800">
			<h:form id="documentosform">
				<p:dataTable var="docs"
					value="#{docketMB.listaDococumentosDocket}" paginator="true" rows="10"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					rowsPerPageTemplate="5,10,15"
					style="FONT-SIZE: 10pt;" emptyMessage="">

					<p:column style="text-align: center;"
						sortBy="#{docs.documentoNome}"
						filterBy="#{docs.documentoNome}" filterMatchMode="contains">
						<f:facet name="header">
							<h:outputText value="Nome Documento" />
						</f:facet>
						<h:outputText value="#{docs.documentoNome}" />
					</p:column>
					
					<p:column style="text-align: center;">
						<p:commandButton ajax="true" icon="ui-icon ui-icon-check"
							action="#{docketMB.adicionaDoc(docs)}"
							update=":form:DocketPanel"
							oncomplete="PF('documentosDialog').hide();" />
					</p:column>

					<f:facet name="footer">
						<p:commandButton value="Cancelar" icon="ui-icon ui-icon-cancel"
							oncomplete="PF('documentosDialog').hide();" />
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:dialog>
					
					

		<p:dialog header="Contratos" widgetVar="contratoCobrancaDialog"
			resizable="false" style="FONT-SIZE: 10pt;" width="800">
			<h:form id="contratoDialogdlg">
				<p:dataTable var="contratos"
					value="#{docketMB.listaContratosConsultar}" paginator="true" rows="10"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					rowsPerPageTemplate="5,10,15"
					selection="#{docketMB.objetoContratoCobranca}"
					style="FONT-SIZE: 10pt;" emptyMessage="">

					<p:column style="text-align: center;"
						sortBy="#{contratos.numeroContrato}"
						filterBy="#{contratos.numeroContrato}" filterMatchMode="contains">
						<f:facet name="header">
							<h:outputText value="Numero Contrato" />
						</f:facet>
						<h:outputText value="#{contratos.numeroContrato}" />
					</p:column>

					<p:column style="text-align: center;"
						sortBy="#{contratos.pagador.nome}"
						filterBy="#{contratos.pagador.nome}" filterMatchMode="contains">
						<f:facet name="header">
							<h:outputText value="Nome Pagador" />
						</f:facet>
						<h:outputText value="#{contratos.pagador.nome}" />
					</p:column>
					
					<p:column style="text-align: center;">
						<p:commandButton ajax="true" icon="ui-icon ui-icon-check"
							action="#{docketMB.populateSelectedContratoCobranca}"
							update=":form:DocketPanel"
							oncomplete="PF('contratoCobrancaDialog').hide();" >
							<f:setPropertyActionListener 
								target="#{docketMB.objetoContratoCobranca}" value="#{contratos}" />
						</p:commandButton>
					</p:column>

					<f:facet name="footer">
						<p:commandButton value="Limpar Seleção"
							action="#{docketMB.clearContratoCobranca()}"
							icon="ui-icon ui-icon-trash" update="contratoDialogdlg"
							oncomplete="PF('contratoCobrancaDialog').hide();" />
						<p:commandButton value="Cancelar" icon="ui-icon ui-icon-cancel"
							oncomplete="PF('contratoCobrancaDialog').hide();" />
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:dialog>
		
	</ui:define>
</ui:composition>
